<?
	$page["title"] = "High-level representation of monitored data";
	$page["file"] = "services.html";

	include "include/config.inc";
	show_header($page["title"],0,0);
?>

<?
	if(isset($register))
	{
		if($register=="add")
		{
			$result=add_service($name,$triggerid,$linktrigger);
			show_messages($result,"Service added","Cannot add service");
		}
		if($register=="add link")
		{
			$result=add_service_link($servicedownid,$serviceupid);
			show_messages($result,"Service link added","Cannot add service link");
		}
	}
?>

<?
	show_table_header("IT's SERVICES");

	echo "<br>";

	show_table_header("SERVICES");
?>
<?
	$now=time();
	$result=DBselect("select serviceid,name from services order by name");
	echo "<table border=0 width=100% bgcolor='#CCCCCC' cellspacing=1 cellpadding=3>";
	echo "\n";
	echo "<tr><td><b>Service</b></td></tr>";
	echo "\n";
	$col=0;
	for($i=0;$i<DBnum_rows($result);$i++)
	{
		$serviceid_=DBget_field($result,$i,0);
		$name_=DBget_field($result,$i,1);

		if(isset($serviceid)&&($serviceid==$serviceid_))
		{
			echo "<tr bgcolor=#99AABB>";
		}
		else
		{
			if($col==1)
			{
				echo "<tr bgcolor=#EEEEEE>";
				$col=0;
			} else
			{
				echo "<tr bgcolor=#DDDDDD>";
				$col=1;
			}
		}
		echo "<td><a href=\"services.html?serviceid=$serviceid_\">$name_</a></td>";
		echo "</tr>"; 
	}
	echo "</table>";
?>

<?
	if(isset($serviceid))
	{
		$result=DBselect("select serviceid,triggerid,name from services where serviceid=$serviceid");
		$triggerid=DBget_field($result,0,1);
		$name=DBget_field($result,0,2);
	}
	else
	{
		$name="";
		unset($triggerid);
	}

	echo "<br>";
	show_table2_header_begin();
	echo "New service";

	show_table2_v_delimiter();
	echo "<form method=\"post\" action=\"services.html\">";
	if(isset($serviceid))
	{
		echo "<input name=\"serviceid\" type=\"hidden\" value=$serviceid>";
	}
	echo "Name";
	show_table2_h_delimiter();
	echo "<input name=\"name\" value=\"$name\" size=32>";

        show_table2_v_delimiter();
        echo "Link to trigger ?";
        show_table2_h_delimiter();
	if(isset($linktrigger)&&($triggerid!=""))
	{
        	echo "<INPUT TYPE=\"CHECKBOX\" NAME=\"linktrigger\" VALUE=\"true\">";
	}
	else
	{
        	echo "<INPUT TYPE=\"CHECKBOX\" NAME=\"linktrigger\">";
	}

	show_table2_v_delimiter();
	echo "Trigger";
	show_table2_h_delimiter();
        $result=DBselect("select triggerid,description from triggers order by description");
        echo "<select name=\"triggerid\" size=1>";
        for($i=0;$i<DBnum_rows($result);$i++)
        {
                $triggerid_=DBget_field($result,$i,0);
                $description_=DBget_field($result,$i,1);
                if(isset($triggerid) && ($triggerid==$triggerid_))
                {
                        echo "<OPTION VALUE='$triggerid_' SELECTED>$description_";
                }
                else
                {
                        echo "<OPTION VALUE='$triggerid_'>$description_";
                }
        }
        echo "</SELECT>";
	show_table2_v_delimiter2();
	echo "<input type=\"submit\" name=\"register\" value=\"add\">";
	if(isset($serviceid))
	{
		echo "<input type=\"submit\" name=\"register\" value=\"update\">";
	}

	show_table2_header_end();
?>

<?
	if(isset($serviceid))
	{
		$result=DBselect("select serviceid,triggerid,name from services where serviceid=$serviceid");
		$triggerid=DBget_field($result,0,1);
		$name=DBget_field($result,0,2);
	}
	else
	{
		$name="";
		unset($triggerid);
	}

	echo "<br>";
	show_table2_header_begin();
	echo "New link";

	show_table2_v_delimiter();
	echo "<form method=\"post\" action=\"services.html\">";
	if(isset($serviceid))
	{
		echo "<input name=\"serviceid\" type=\"hidden\" value=$serviceid>";
		echo "<input name=\"servicedownid\" type=\"hidden\" value=$serviceid>";
	}
	echo "Name";
	show_table2_h_delimiter();
	$result=DBselect("select serviceid,triggerid,name from services order by name");
        echo "<select name=\"serviceupid\" size=1>";
        for($i=0;$i<DBnum_rows($result);$i++)
        {
                $serviceupid_=DBget_field($result,$i,0);
                $name_=DBget_field($result,$i,2);
		echo "<OPTION VALUE='$serviceupid_'>$name_";
        }
        echo "</SELECT>";

        show_table2_v_delimiter();
        echo "Soft link ?";
        show_table2_h_delimiter();
	if(isset($softlink)&&($triggerid!=""))
	{
        	echo "<INPUT TYPE=\"CHECKBOX\" NAME=\"softlink\" VALUE=\"true\">";
	}
	else
	{
        	echo "<INPUT TYPE=\"CHECKBOX\" NAME=\"softlink\">";
	}

	show_table2_v_delimiter2();
	echo "<input type=\"submit\" name=\"register\" value=\"add link\">";

	show_table2_header_end();
?>

<?
	show_footer();
?>
